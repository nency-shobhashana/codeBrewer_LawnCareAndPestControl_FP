<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="images/png" sizes="32x32" href="images/logo.svg">
	<title>Login</title>
	<!-- CSS file -->
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/media.css">

</head>
<body>


<header>
	<div class="header-bar">
		<div class="container">
			<div class="tagline">100% Guarantee Service!!!</div>
			<div class="contact">+1 (647) 758-6542</div>
		</div>
	</div>
	<div class="header-content">
		<div class="container">
			<div class="logo">
				<a href="index.html">
					<img src="images/logo.svg" alt="Lawn care and pest control">
				</a>
			</div>
			<nav>
				<ul>
					<li>
						Services
						<ul>
							<li>
								<a href="lawnCare.html">Lawn Care</a>
							</li>
							<li>
								<a href="pestControl.html">Lawn Pest Control</a>
							</li>
						</ul>
					</li>
					<li><a href="serviceArea.html">Service Area</a></li>
					<li><a href="faq.html">FAQ</a></li>
					<li><a href="aboutUs.html">About Us</a></li>
					<li><a href="contactUs.html">Contact Us</a></li>
					<li><a href="myaccount.html">My account</a></li>
					<li><a href="login.html">Login/Resiter</a></li>
				</ul>
			</nav>
		</div>
	</div>
</header>

<main>
	<div class="container">
		<h2 class="text-uppercase color-green font-30">Welcome to a member of Lawn care and Lawn pest control</h2>
		<p>If you are new please register your self first</p>
		<div class="user-block">
			<div class="login col-2">
				<h3 class="title text-uppercase font-25">Login</h3>
				<form onsubmit="login(event);">
					<div class="form-group">
						<input type="email" id="email" name="email" placeholder="Email Address" required>
					</div>
					<div class="form-group">
						<input type="password" id="password" name="password" placeholder="Password" required>
					</div>
					<div class="text-center">
						<input type="submit" value="Login">
					</div>
				</form>
			</div>
			<div class="login col-2">
				<h3 class="title text-uppercase font-25">Register</h3>
				<form id="regForm" onsubmit="signUp(event);">
					<div class="form-group">
						<input type="text" id="fname" name="fname" placeholder="First Name" required>
					</div>
					<div class="form-group">
						<input type="text" id="lname" name="lname" placeholder="Last Name" required>
					</div>
					<div class="form-group">
						<input type="email" id="registerEmail" name="email" placeholder="Email Address" required>
					</div>
					<div class="form-group">
						<input type="password" id="registerPassword" name="password" placeholder="Password" required>
					</div>
					<div class="form-group">
						<input type="tel" id="phone" name="phone" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" placeholder="Phone number (Format:123-456-7890)" required>
					</div>
					<div class="form-group">
						<div class="col-3">
							<input type="number" id="birthday" name="birthday" min="1" max="31" placeholder="Birth Day" required>
						</div>
						<div class="col-3">
							<input type="number" id="birthmonth" name="birthmonth" min="1" max="12" placeholder="Birth Month" required>
						</div>
						<div class="col-3">
							<input type="number" id="birthyear" name="birthyear" min="1950" max="2021" placeholder="Birth Year" required>
						</div>
					</div>
					<div class="form-group">
						<input type="radio" id="male" name="gender" value="male">
						<label for="male">Male</label>

						<input type="radio" id="female" name="gender" value="female">
						<label for="female">Female</label>
					</div>
					<div class="form-group">
						<div class="col-3">
							<input type="text" id="address" name="address" placeholder="Address">
						</div>
						<select id="city" name="city" class="col-3">
							<option value="toronto">Toronto</option>
							<option value="brampton">Brampton</option>
							<option value="mississauga">Mississauga</option>
							<option value="guelph">Guelph</option>
							<option value="kitchener">Kitchener</option>
						</select>
						<select id="province" name="province" class="col-3">
							<option value="Ontario">Ontario</option>
							<option value="british">British columbia</option>
							<option value="alberta">Alberta</option>
						</select>
					</div>
					<div class="form-group">
						<input type="checkbox" required name="terms"> I accept the <u>data entered are not fictitious</u>
					</div>
					<div class="text-center">
						<input type="submit" value="Register">
						<input type="button" value="Clear Data" onclick="cleardata()">
					</div>
				</form>
			</div>
		</div>
	</div>
</main>

<footer>
	<div class="footer">
		<div class="container">
			<div class="footer-section col-3 text-center">
				<img src="images/logo.svg" width="70" class="logo-img">
				<h3 class="text-uppercase font-25">Services</h3>
				<ul>
					<li>Lawn care</li>
					<li>Lawn pest control</li>
				</ul>
			</div>

			<div class="footer-section col-3 text-center">
				<h3 class="title text-uppercase font-25">Our store</h3>
				<h4 class="font-20">Address:</h4>
				<div class="address">Ontario, Canada</div>
				<h4 class="font-20">Opening time:</h4>
				<div class="time">Monday to Saturday (10:00 AM to 6:00 PM)</div>
			</div>

			<div class="footer-section col-3 text-center">
				<h3 class="title text-uppercase font-25">Contact Us</h3>
				<h4 class="font-20">E-mail:</h4>
				<div class="email">lawncare@pestcontrol.com</div>
				<h4 class="font-20">Contact Number:</h4>
				<div class="contact">+1 (647) 758-6542</div>
			</div>
		</div>
	</div>
	<div class="footer-copyright text-center">
		<div class="container">
			<h4>&copy; 2021 Nency Shobhashana. All rights reserved.</h4>
		</div>
	</div>
</footer>

<script src="js/script.js"></script>
<script type="text/javascript">
let db;

function init(){
console.log("init called");
window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
  // DON'T use "var indexedDB = ..." if you're not in a function.
  // Moreover, you may need references to some window.IDB* objects:
  window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
  window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
  // (Mozilla has never prefixed these objects, so we don't need window.mozIDB*)

  // Let us open our database
  const DBOpenRequest = window.indexedDB.open("LawnCare", 1);

  DBOpenRequest.onsuccess = function(event) {

	console.log("DBOpenRequest.onsuccess done");
    // store the result of opening the database in the db variable. This is used a lot below
    db = DBOpenRequest.result;

  };

  DBOpenRequest.onupgradeneeded = function(event) {
    console.log("onupgradeneeded start");
    let db = event.target.result;

    db.onerror = function(event) {
      note.innerHTML += '<li>Error loading database.</li>';
    };

    // Create an objectStore for this database

    let objectStore = db.createObjectStore("user", { keyPath: "email" });

    // define what data items the objectStore will contain

    objectStore.createIndex("fname", "fname", { unique: false });
    objectStore.createIndex("lname", "lname", { unique: false });
    objectStore.createIndex("pwd", "pwd", { unique: false });
    objectStore.createIndex("phone", "phone", { unique: false });
    objectStore.createIndex("birthday", "birthday", { unique: false });
    objectStore.createIndex("birthmonth", "birthmonth", { unique: false });
    objectStore.createIndex("birthyear", "birthyear", { unique: false });
    objectStore.createIndex("gender", "gender", { unique: false });
    objectStore.createIndex("address", "address", { unique: false });

	console.log("onupgradeneeded done");
  };
	console.log("init done");
}

window.onload = init

const signUp = e => {
	let gender = document.getElementById('male').checked ? "Male" : document.getElementById('female').checked ? "Female" : "Not Specified"
	let formData = {
	fname: document.getElementById('fname').value,
	lname: document.getElementById('lname').value,
	email: document.getElementById('registerEmail').value,
	pwd: document.getElementById('registerPassword').value,
	phone: document.getElementById('phone').value,
    birthday: document.getElementById('birthday').value,
    birthmonth: document.getElementById('birthmonth').value,
    birthyear: document.getElementById('birthyear').value,
    gender: gender,
    address: document.getElementById('address').value + ", " + document.getElementById('city').value + ", " + document.getElementById('province').value,
     }

	let transaction = db.transaction(["user"], "readwrite");
	console.log("transaction start");
	transaction.oncomplete = function() {
		cleardata();
		console.log("transaction done");
	};

    let objectStore = transaction.objectStore("user");

    // Make a request to add our newItem object to the object store
    objectStore.add(formData);
    console.log("objectStore add done");
}
document.getElementById('email')
const login = e => {
	let email = document.getElementById('email').value;
	let pwd = document.getElementById('password').value;

	let objectStore = db.transaction('user').objectStore("user");

	objectStore.openCursor().onsuccess = function(event) {
	  let cursor = event.target.result;
		// if there is still another cursor to go, keep runing this code
		if(cursor) {
		  if(cursor.value.email == email && cursor.value.pwd == pwd){
			localStorage.setItem('lawCareCurrentUser', email);
			window.location.href = "myaccount.html";
		  }
		  cursor.continue();
		// if there are no more cursor items to iterate through, say so, and exit the function
		} else {
		  console.log("user not found");
		}
	  }
}
</script>
</body>
</html>